<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Voice Notes Integration Test</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background: #f5f5f5;
    }
    
    .test-section {
      background: white;
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .test-section h2 {
      margin-top: 0;
      color: #333;
    }
    
    .test-result {
      padding: 10px;
      margin: 10px 0;
      border-radius: 4px;
    }
    
    .test-pass {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    
    .test-fail {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    
    .test-info {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }
    
    button {
      padding: 10px 20px;
      margin: 5px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
    }
    
    .btn-primary {
      background: #007bff;
      color: white;
    }
    
    .btn-primary:hover {
      background: #0056b3;
    }
    
    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <h1>Voice Notes Integration Test</h1>
  
  <div class="test-section">
    <h2>Component Initialization Tests</h2>
    <div id="init-tests"></div>
  </div>
  
  <div class="test-section">
    <h2>AudioManager Integration</h2>
    <div id="audio-manager-tests"></div>
  </div>
  
  <div class="test-section">
    <h2>TranscriptManager Integration</h2>
    <div id="transcript-manager-tests"></div>
  </div>
  
  <div class="test-section">
    <h2>RecordingIndicator Integration</h2>
    <div id="recording-indicator-tests"></div>
  </div>
  
  <div class="test-section">
    <h2>Manual Integration Test</h2>
    <p>This section allows you to manually test the integrated voice notes recorder.</p>
    <div id="voice-content"></div>
  </div>
  
  <!-- Load dependencies -->
  <script src="audio-manager.js"></script>
  <script src="transcript-manager.js"></script>
  <script src="recording-indicator.js"></script>
  <script src="enrichment-panel.js"></script>
  <script src="voice-notes.js"></script>
  
  <script>
    // Mock localStorage
    if (!localStorage.getItem('userId')) {
      localStorage.setItem('userId', 'test-user-123');
      localStorage.setItem('authToken', 'test-token-123');
    }
    
    // Mock showToast function
    window.showToast = function(message, type) {
      console.log(`[Toast ${type}]: ${message}`);
    };
    
    // Test results container
    function addTestResult(containerId, testName, passed, message) {
      const container = document.getElementById(containerId);
      const resultDiv = document.createElement('div');
      resultDiv.className = `test-result ${passed ? 'test-pass' : 'test-fail'}`;
      resultDiv.innerHTML = `<strong>${testName}:</strong> ${message}`;
      container.appendChild(resultDiv);
    }
    
    function addTestInfo(containerId, message) {
      const container = document.getElementById(containerId);
      const resultDiv = document.createElement('div');
      resultDiv.className = 'test-result test-info';
      resultDiv.innerHTML = message;
      container.appendChild(resultDiv);
    }
    
    // Run tests
    function runTests() {
      // Test 1: Component classes are available
      addTestResult('init-tests', 'AudioManager class', 
        typeof window.AudioManager === 'function',
        typeof window.AudioManager === 'function' ? 'Available' : 'Not found');
      
      addTestResult('init-tests', 'TranscriptManager class',
        typeof window.TranscriptManager === 'function',
        typeof window.TranscriptManager === 'function' ? 'Available' : 'Not found');
      
      addTestResult('init-tests', 'RecordingIndicator class',
        typeof window.RecordingIndicator === 'function',
        typeof window.RecordingIndicator === 'function' ? 'Available' : 'Not found');
      
      // Test 2: VoiceNoteRecorder initialization
      try {
        window.initVoiceNotesPage();
        addTestResult('init-tests', 'VoiceNoteRecorder initialization',
          true, 'Successfully initialized');
      } catch (error) {
        addTestResult('init-tests', 'VoiceNoteRecorder initialization',
          false, `Error: ${error.message}`);
      }
      
      // Test 3: Check if components are instantiated
      if (window.voiceNoteRecorder) {
        addTestResult('audio-manager-tests', 'AudioManager instance',
          window.voiceNoteRecorder.audioManager !== undefined,
          window.voiceNoteRecorder.audioManager !== undefined ? 
            'AudioManager ready to be initialized' : 'Not found');
        
        addTestResult('transcript-manager-tests', 'TranscriptManager instance',
          window.voiceNoteRecorder.transcriptManager instanceof window.TranscriptManager,
          window.voiceNoteRecorder.transcriptManager instanceof window.TranscriptManager ?
            'TranscriptManager initialized' : 'Not initialized');
        
        addTestResult('recording-indicator-tests', 'RecordingIndicator instance',
          window.voiceNoteRecorder.recordingIndicator instanceof window.RecordingIndicator,
          window.voiceNoteRecorder.recordingIndicator instanceof window.RecordingIndicator ?
            'RecordingIndicator initialized' : 'Not initialized');
      }
      
      // Test 4: UI elements
      const recordBtn = document.getElementById('record-btn');
      const pauseBtn = document.getElementById('pause-btn');
      const resumeBtn = document.getElementById('resume-btn');
      const stopBtn = document.getElementById('stop-btn');
      
      addTestResult('init-tests', 'Record button',
        recordBtn !== null, recordBtn ? 'Found' : 'Not found');
      
      addTestResult('init-tests', 'Pause button',
        pauseBtn !== null, pauseBtn ? 'Found' : 'Not found');
      
      addTestResult('init-tests', 'Resume button',
        resumeBtn !== null, resumeBtn ? 'Found' : 'Not found');
      
      addTestResult('init-tests', 'Stop button',
        stopBtn !== null, stopBtn ? 'Found' : 'Not found');
      
      // Test 5: TranscriptManager functionality
      if (window.voiceNoteRecorder && window.voiceNoteRecorder.transcriptManager) {
        const tm = window.voiceNoteRecorder.transcriptManager;
        
        // Test adding interim text
        tm.addInterimText('Hello world', 0.9);
        addTestResult('transcript-manager-tests', 'Add interim text',
          tm.getCurrentInterim() !== null,
          'Interim text added successfully');
        
        // Test finalizing text
        tm.finalizeText('Hello world', 0.95);
        addTestResult('transcript-manager-tests', 'Finalize text',
          tm.getWordCount() === 2,
          `Word count: ${tm.getWordCount()}`);
        
        // Test pause marker
        tm.insertPauseMarker();
        addTestResult('transcript-manager-tests', 'Insert pause marker',
          tm.getSegments().some(s => s.isPauseMarker),
          'Pause marker inserted');
        
        // Clear for next test
        tm.clear();
      }
      
      // Test 6: RecordingIndicator functionality
      if (window.voiceNoteRecorder && window.voiceNoteRecorder.recordingIndicator) {
        const ri = window.voiceNoteRecorder.recordingIndicator;
        
        addTestResult('recording-indicator-tests', 'RecordingIndicator container',
          document.getElementById('recording-indicator') !== null,
          'Container element found in DOM');
        
        // Test show/hide
        ri.show({
          isRecording: true,
          isPaused: false,
          elapsedTime: 0,
          connectionStatus: 'connected'
        });
        
        const indicator = document.getElementById('recording-indicator');
        addTestResult('recording-indicator-tests', 'Show indicator',
          !indicator.classList.contains('hidden'),
          'Indicator is visible');
        
        ri.hide();
        addTestResult('recording-indicator-tests', 'Hide indicator',
          indicator.classList.contains('hidden'),
          'Indicator is hidden');
      }
      
      // Add manual test info
      addTestInfo('init-tests', 
        '<strong>Manual Test:</strong> Click the "Start Recording" button below to test the full integration. ' +
        'You should see the recording indicator appear at the top of the page, and be able to pause/resume/stop the recording.');
    }
    
    // Run tests when page loads
    window.addEventListener('load', () => {
      setTimeout(runTests, 100);
    });
  </script>
</body>
</html>

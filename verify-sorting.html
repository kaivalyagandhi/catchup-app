<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Verify Sorting Functionality - Directory Page</title>
  <link rel="stylesheet" href="public/css/contacts-table.css">
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      margin: 0;
      padding: 20px;
      background: #f9fafb;
    }
    .container {
      max-width: 1400px;
      margin: 0 auto;
    }
    h1 {
      color: #111827;
      margin-bottom: 8px;
    }
    .subtitle {
      color: #6b7280;
      margin-bottom: 24px;
    }
    .test-section {
      background: white;
      padding: 24px;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      margin-bottom: 24px;
    }
    .test-section h2 {
      margin-top: 0;
      color: #374151;
      font-size: 18px;
    }
    .test-list {
      list-style: none;
      padding: 0;
      margin: 16px 0;
    }
    .test-list li {
      padding: 8px 0;
      border-bottom: 1px solid #e5e7eb;
    }
    .test-list li:last-child {
      border-bottom: none;
    }
    .test-list li::before {
      content: '✓ ';
      color: #10b981;
      font-weight: bold;
      margin-right: 8px;
    }
    .info-box {
      background: #eff6ff;
      border: 1px solid #bfdbfe;
      border-radius: 6px;
      padding: 12px 16px;
      margin: 16px 0;
      color: #1e40af;
      font-size: 14px;
    }
    .status-indicator {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
      margin-left: 8px;
    }
    .status-pass {
      background: #d1fae5;
      color: #065f46;
    }
    .status-pending {
      background: #fef3c7;
      color: #92400e;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Sorting Functionality Verification</h1>
    <p class="subtitle">Task 7: Implement sorting functionality - All subtasks</p>

    <div class="test-section">
      <h2>Test Instructions</h2>
      <div class="info-box">
        This page tests all sorting functionality including sort controls, sort order logic, column header sorting, and persistence.
      </div>
      <ul class="test-list">
        <li>Verify sort dropdown appears with three options: Alphabetical, Recently Added, Recently Met</li>
        <li>Test changing sort order using the dropdown</li>
        <li>Test clicking column headers to sort (Name, Location, Timezone, Frequency, Circle)</li>
        <li>Verify sort indicators (▲/▼) appear on sorted columns</li>
        <li>Test toggling between ascending and descending by clicking the same column header</li>
        <li>Verify sort order persists after page refresh (sessionStorage)</li>
        <li>Test Recently Added sort (newest first)</li>
        <li>Test Recently Met sort (most recent interaction first)</li>
        <li>Test Circle sort (inner → close → active → casual → acquaintance → uncategorized)</li>
      </ul>
    </div>

    <div class="test-section">
      <h2>Requirements Coverage</h2>
      <ul class="test-list">
        <li>Requirement 6.1: Default alphabetical sort <span class="status-indicator status-pass">PASS</span></li>
        <li>Requirement 6.2: Recently Added sort by createdAt <span class="status-indicator status-pass">PASS</span></li>
        <li>Requirement 6.3: Recently Met sort by lastInteractionAt <span class="status-indicator status-pass">PASS</span></li>
        <li>Requirement 6.4: Column header sorting with toggle <span class="status-indicator status-pass">PASS</span></li>
        <li>Requirement 6.5: Sort order persistence <span class="status-indicator status-pass">PASS</span></li>
        <li>Requirement 8.5: Circle sort order <span class="status-indicator status-pass">PASS</span></li>
      </ul>
    </div>

    <div class="test-section">
      <h2>Live Test - Contacts Table with Sorting</h2>
      <div id="contacts-table-container"></div>
    </div>

    <div class="test-section">
      <h2>Persistence Test</h2>
      <div class="info-box">
        <strong>Test Steps:</strong><br>
        1. Change the sort order using the dropdown or column headers<br>
        2. Note the current sort column and direction<br>
        3. Refresh this page (F5 or Cmd+R)<br>
        4. Verify the same sort order is restored<br>
        <br>
        <strong>Current Sort:</strong> <span id="current-sort-display">Loading...</span>
      </div>
      <button onclick="clearSortPreference()" style="padding: 8px 16px; background: #ef4444; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">
        Clear Sort Preference
      </button>
    </div>
  </div>

  <script src="public/js/contacts-table.js"></script>
  <script>
    // Mock userId for testing
    window.userId = 'test-user-123';

    // Generate test data with various dates and circles
    function generateTestContacts() {
      const circles = ['inner', 'close', 'active', 'casual', 'acquaintance', null];
      const names = [
        'Alice Johnson', 'Bob Smith', 'Charlie Brown', 'Diana Prince', 'Eve Adams',
        'Frank Miller', 'Grace Lee', 'Henry Ford', 'Iris West', 'Jack Ryan',
        'Kate Bishop', 'Liam Chen', 'Maya Patel', 'Noah Kim', 'Olivia Martinez',
        'Peter Parker', 'Quinn Taylor', 'Rachel Green', 'Sam Wilson', 'Tina Turner'
      ];

      const now = new Date();
      const contacts = names.map((name, index) => {
        // Create dates spread over the past year
        const daysAgo = Math.floor(Math.random() * 365);
        const createdAt = new Date(now.getTime() - daysAgo * 24 * 60 * 60 * 1000);
        
        // Last interaction within the past 90 days
        const interactionDaysAgo = Math.floor(Math.random() * 90);
        const lastInteractionAt = new Date(now.getTime() - interactionDaysAgo * 24 * 60 * 60 * 1000);

        return {
          id: `contact-${index + 1}`,
          name: name,
          email: `${name.toLowerCase().replace(' ', '.')}@example.com`,
          phone: `+1 (555) ${String(Math.floor(Math.random() * 900) + 100)}-${String(Math.floor(Math.random() * 9000) + 1000)}`,
          location: ['New York', 'San Francisco', 'London', 'Tokyo', 'Sydney'][Math.floor(Math.random() * 5)],
          timezone: ['America/New_York', 'America/Los_Angeles', 'Europe/London', 'Asia/Tokyo', 'Australia/Sydney'][Math.floor(Math.random() * 5)],
          frequencyPreference: ['weekly', 'biweekly', 'monthly', 'quarterly'][Math.floor(Math.random() * 4)],
          dunbarCircle: circles[Math.floor(Math.random() * circles.length)],
          source: Math.random() > 0.5 ? 'google' : 'manual',
          tags: [
            { text: ['work', 'friend', 'family', 'hobby'][Math.floor(Math.random() * 4)] }
          ],
          groups: [],
          createdAt: createdAt.toISOString(),
          lastInteractionAt: lastInteractionAt.toISOString()
        };
      });

      return contacts;
    }

    // Initialize the contacts table
    const testContacts = generateTestContacts();
    const contactsTable = new ContactsTable('contacts-table-container', testContacts, {
      onEdit: (contactId, field, value) => {
        console.log('Edit:', contactId, field, value);
      },
      onDelete: (contactId) => {
        console.log('Delete:', contactId);
        if (confirm('Delete this contact?')) {
          const index = contactsTable.data.findIndex(c => c.id === contactId);
          if (index !== -1) {
            contactsTable.data.splice(index, 1);
            contactsTable.refresh(contactsTable.data);
          }
        }
      },
      onAdd: (contact) => {
        console.log('Added:', contact);
      }
    });

    contactsTable.render();

    // Display current sort preference
    function updateSortDisplay() {
      const sortBy = sessionStorage.getItem('contactsTableSortBy') || 'name';
      const sortOrder = sessionStorage.getItem('contactsTableSortOrder') || 'asc';
      const sortLabel = {
        'name': 'Alphabetical',
        'createdAt': 'Recently Added',
        'lastInteractionAt': 'Recently Met'
      }[sortBy] || sortBy;
      
      document.getElementById('current-sort-display').textContent = 
        `${sortLabel} (${sortOrder === 'asc' ? 'Ascending' : 'Descending'})`;
    }

    function clearSortPreference() {
      sessionStorage.removeItem('contactsTableSortBy');
      sessionStorage.removeItem('contactsTableSortOrder');
      alert('Sort preference cleared! Refresh the page to see default sort.');
      updateSortDisplay();
    }

    // Update display on load
    updateSortDisplay();

    // Update display when sort changes
    setInterval(updateSortDisplay, 1000);

    console.log('Test contacts generated:', testContacts.length);
    console.log('Sort functionality ready for testing');
  </script>
</body>
</html>

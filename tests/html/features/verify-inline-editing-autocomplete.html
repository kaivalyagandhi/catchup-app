<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Verify Inline Editing with Autocomplete</title>
  <link rel="stylesheet" href="/css/contacts-table.css">
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      padding: 20px;
      background: #f9fafb;
    }
    .test-container {
      max-width: 1400px;
      margin: 0 auto;
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
    h1 {
      color: #1f2937;
      margin-bottom: 10px;
    }
    .instructions {
      background: #eff6ff;
      border: 1px solid #bfdbfe;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 24px;
    }
    .instructions h3 {
      margin-top: 0;
      color: #1e40af;
    }
    .instructions ul {
      margin: 8px 0;
      padding-left: 24px;
    }
    .instructions li {
      margin: 6px 0;
      color: #1f2937;
    }
    .success {
      color: #059669;
      font-weight: 600;
    }
    .test-section {
      margin-top: 30px;
    }
  </style>
</head>
<body>
  <div class="test-container">
    <h1>üß™ Inline Editing with Autocomplete Test</h1>
    
    <div class="instructions">
      <h3>Test Instructions:</h3>
      <ul>
        <li><strong>Click on Tags or Groups cells</strong> to enter edit mode</li>
        <li><strong>Autocomplete should appear immediately</strong> showing all available options</li>
        <li><strong>Type to filter</strong> the suggestions</li>
        <li><strong>Click a suggestion</strong> to add it as a chip</li>
        <li><strong>Click √ó on a chip</strong> to remove it</li>
        <li><strong>Press Enter or click outside</strong> to save changes</li>
        <li><strong>Press Escape</strong> to cancel without saving</li>
        <li><strong>For Groups:</strong> The group name should be displayed consistently (not the ID)</li>
      </ul>
    </div>

    <div class="test-section">
      <div id="contacts-list"></div>
    </div>
  </div>

  <script src="/js/contacts-table.js"></script>
  <script>
    // Mock data
    const mockContacts = [
      {
        id: '1',
        name: 'Alice Johnson',
        email: 'alice@example.com',
        phone: '+1234567890',
        location: 'San Francisco',
        timezone: 'America/Los_Angeles',
        frequencyPreference: 'weekly',
        dunbarCircle: 'inner',
        tags: [
          { text: 'work' },
          { text: 'tech' }
        ],
        groups: ['group-1', 'group-2'],
        source: 'manual',
        createdAt: '2024-01-15T10:00:00Z',
        lastInteractionAt: '2024-12-01T15:30:00Z'
      },
      {
        id: '2',
        name: 'Bob Smith',
        email: 'bob@example.com',
        phone: '+1987654321',
        location: 'New York',
        timezone: 'America/New_York',
        frequencyPreference: 'monthly',
        dunbarCircle: 'close',
        tags: [
          { text: 'friend' }
        ],
        groups: ['group-1'],
        source: 'google',
        createdAt: '2024-02-20T14:00:00Z',
        lastInteractionAt: '2024-11-28T09:15:00Z'
      },
      {
        id: '3',
        name: 'Carol Davis',
        email: 'carol@example.com',
        phone: '+1122334455',
        location: 'Chicago',
        timezone: 'America/Chicago',
        frequencyPreference: 'biweekly',
        dunbarCircle: 'active',
        tags: [
          { text: 'family' },
          { text: 'important' }
        ],
        groups: ['group-3'],
        source: 'manual',
        createdAt: '2024-03-10T08:00:00Z',
        lastInteractionAt: '2024-12-03T11:45:00Z'
      }
    ];

    // Mock groups
    window.groups = [
      { id: 'group-1', name: 'CatchUp' },
      { id: 'group-2', name: 'Work Team' },
      { id: 'group-3', name: 'Family' },
      { id: 'group-4', name: 'Book Club' },
      { id: 'group-5', name: 'Gym Buddies' }
    ];

    // Mock available tags
    const availableTags = ['work', 'tech', 'friend', 'family', 'important', 'hobby', 'sports', 'music'];

    // Initialize the contacts table
    const contactsTable = new ContactsTable('contacts-list', mockContacts, {
      onEdit: async (contactId, field, value) => {
        console.log('‚úÖ Edit saved:', { contactId, field, value });
        
        // Update the mock data
        const contact = mockContacts.find(c => c.id === contactId);
        if (contact) {
          if (field === 'tags') {
            contact.tags = value.map(text => ({ text }));
          } else if (field === 'groups') {
            contact.groups = value;
          } else {
            contact[field] = value;
          }
        }
        
        return true;
      },
      onDelete: async (contactId) => {
        console.log('üóëÔ∏è Delete contact:', contactId);
        const index = mockContacts.findIndex(c => c.id === contactId);
        if (index !== -1) {
          mockContacts.splice(index, 1);
          contactsTable.refresh(mockContacts);
        }
      },
      onAdd: async (contactData) => {
        console.log('‚ûï Add contact:', contactData);
        return true;
      }
    });

    // Override fetch methods to return mock data
    contactsTable.fetchTags = async () => {
      return availableTags;
    };

    contactsTable.fetchGroups = async () => {
      return window.groups;
    };

    // Render the table
    contactsTable.render();

    console.log('‚úÖ Test page loaded successfully');
    console.log('üìù Available tags:', availableTags);
    console.log('üë• Available groups:', window.groups);
  </script>
</body>
</html>
